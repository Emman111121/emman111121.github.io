<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Emman M. — Poetry Portfolio</title>
<style>
:root{--bg:#faf9f7;--text:#222;--accent:#6b46c1;--card:#fff;--muted:#666;--maxw:900px}
*{box-sizing:border-box}
body{font-family:Georgia,serif;margin:0;background:var(--bg);color:var(--text);}
.container{max-width:var(--maxw);margin:2rem auto;padding:1rem}
header{text-align:center;margin-bottom:1rem}
h1{margin:0;font-size:2rem}
.muted{color:var(--muted)}
.controls{display:flex;gap:0.5rem;justify-content:center;margin-top:0.5rem;flex-wrap:wrap}
.card{background:var(--card);padding:1rem;border-radius:10px;box-shadow:0 1px 6px rgba(0,0,0,.06);margin-bottom:1rem}
.form-grid{display:grid;grid-template-columns:1fr 160px;gap:0.5rem}
textarea{min-height:160px;resize:vertical;width:100%;padding:0.6rem;font-size:1rem;font-family:inherit}
input,textarea,button,select{font-family:inherit}
.poem-item{display:flex;justify-content:space-between;gap:1rem;align-items:flex-start;padding:0.6rem 0;border-bottom:1px solid #eee}
.poem-meta{color:var(--muted);font-size:0.92rem}
.buttons button{margin-left:0.4rem}
button{background:#eee;border:1px solid #ddd;padding:0.5rem 0.6rem;border-radius:6px;cursor:pointer}
button:hover{filter:brightness(.98)}
@media(max-width:640px){.form-grid{grid-template-columns:1fr}.controls{flex-direction:column}}
</style>
</head>
<body>
<div class="container">
<header>
<h1 id="siteName">Emman M. — Poetry Portfolio</h1>
<p class="muted">Just an online portfolio for the mess in my head.</p>
<div class="controls">
<button id="editNameBtn">Edit Site Name</button>
<button id="exportBtn">Export</button>
<input type="file" id="importFile" accept="application/json" style="display:none"/>
<button id="importBtn">Import</button>
<button id="clearAllBtn">Clear All</button>
</div>
</header>
<main>
<section class="card" id="editorCard">
<h2 id="formTitle">Add a poem</h2>
<form id="poemForm">
<input type="hidden" id="poemId">
<div class="form-grid">
<div>
<label>Title<br><input type="text" id="title" required placeholder="Title"></label><br><br>
<label>Date<br><input type="date" id="date"></label><br><br>
<label>Poem<br><textarea id="content" required placeholder="Write your poem here..."></textarea></label>
</div>
<div>
<div style="display:flex;flex-direction:column;gap:0.5rem;">
<button type="submit" id="saveBtn">Save poem</button>
<button type="button" id="cancelEditBtn" style="display:none">Cancel edit</button>
<button type="button" id="downloadAllBtn">Download all poems (.json)</button>
</div>
</div>
</div>
</form>
</section>
<section class="card" id="poemsCard">
<h2>Poems</h2>
<div id="poemsList"></div>
<p id="emptyMsg" class="muted">No poems yet — write your first poem in the form above.</p>
</section>
</main>
<footer style="text-align:center;margin-top:1rem;color:var(--muted);font-size:0.9rem;">
<p>Tip: use Export to make a backup you can store on your device or share.</p>
</footer>
</div>

<script>
/*
Poetry Portfolio — Single-file starter (index.html)

How to use:
1) Save this file as "index.html" (encoding UTF-8). See the step-by-step instructions in the chat.
2) Open the file in your browser (double-click or right-click → Open with...).
3) Use the form to add poems (title, date, content). Poems save in your browser (localStorage).
4) Use Export to create a JSON backup. Use Import to restore from a backup or to move poems to another device.

Notes:
- If you clear browser data or use private/incognito mode, saved poems may be lost. Always Export a backup if you care about your poems.
- To share the site online, upload this file to GitHub Pages / Netlify / Vercel (instructions in chat).
*/

const STORAGE_KEY = 'poetry_portfolio_v1';
const $ = (sel) => document.querySelector(sel);
const todayInput = () => {
  const d = new Date();
  const mm = String(d.getMonth()+1).padStart(2,'0');
  const dd = String(d.getDate()).padStart(2,'0');
  return `${d.getFullYear()}-${mm}-${dd}`;
};
let poems = [];
const poemForm = $('#poemForm');
const titleInput = $('#title');
const dateInput = $('#date');
const contentInput = $('#content');
const poemIdInput = $('#poemId');
const poemsList = $('#poemsList');
const emptyMsg = $('#emptyMsg');
const saveBtn = $('#saveBtn');
const cancelEditBtn = $('#cancelEditBtn');
const exportBtn = $('#exportBtn');
const importBtn = $('#importBtn');
const importFile = $('#importFile');
const downloadAllBtn = $('#downloadAllBtn');
const clearAllBtn = $('#clearAllBtn');
const editNameBtn = $('#editNameBtn');
const siteNameEl = $('#siteName');

function load() {
  const raw = localStorage.getItem(STORAGE_KEY);
  try {
    poems = raw ? JSON.parse(raw) : [];
  } catch(e) {
    console.error('Failed to parse stored poems', e);
    poems = [];
  }
  render();
}
function save() { localStorage.setItem(STORAGE_KEY, JSON.stringify(poems)); }

function render() {
  poemsList.innerHTML = '';
  if (!poems.length) { emptyMsg.style.display = 'block'; return; }
  emptyMsg.style.display = 'none';
  const sorted = poems.slice().sort((a,b) => {
    if (a.date === b.date) return b.createdAt - a.createdAt;
    return new Date(b.date) - new Date(a.date);
  });
  sorted.forEach(p => {
    const item = document.createElement('div');
    item.className = 'poem-item';
    const left = document.createElement('div');
    const title = document.createElement('strong');
    title.textContent = p.title;
    title.style.cursor = 'pointer';
    title.addEventListener('click', () => viewPoem(p.id));
    const meta = document.createElement('div');
    meta.className = 'poem-meta';
    meta.textContent = p.date || 'No date';
    const excerpt = document.createElement('div');
    excerpt.textContent = p.content.length > 140 ? p.content.slice(0,140) + '…' : p.content;
    left.appendChild(title);
    left.appendChild(meta);
    left.appendChild(excerpt);

    const right = document.createElement('div');
    right.className = 'buttons';
    const viewBtn = document.createElement('button'); viewBtn.textContent = 'View';
    viewBtn.addEventListener('click', () => viewPoem(p.id));
    const editBtn = document.createElement('button'); editBtn.textContent = 'Edit';
    editBtn.addEventListener('click', () => startEdit(p.id));
    const delBtn = document.createElement('button'); delBtn.textContent = 'Delete';
    delBtn.addEventListener('click', () => deletePoem(p.id));
    const dlBtn = document.createElement('button'); dlBtn.textContent = 'Download';
    dlBtn.addEventListener('click', () => downloadPoem(p.id));
    const cpBtn = document.createElement('button'); cpBtn.textContent = 'Copy';
    cpBtn.addEventListener('click', () => navigator.clipboard?.writeText(`${p.title}\n${p.date}\n\n${p.content}`).then(()=>alert('Copied to clipboard')));

    [viewBtn, editBtn, delBtn, dlBtn, cpBtn].forEach(b => { b.style.marginLeft='0.4rem'; right.appendChild(b); });
    item.appendChild(left);
    item.appendChild(right);
    poemsList.appendChild(item);
  });
}

function viewPoem(id) {
  const p = poems.find(x=>x.id===id);
  if (!p) return;
  const win = window.open('', '_blank', 'width=600,height=600,scrollbars=yes');
  const html = `<!doctype html><html><head><meta charset="utf-8"><title>${escapeHtml(p.title)}</title>
  <style>body{font-family:Georgia,serif;padding:2rem;background:#fff;color:#111} h1{margin-top:0} .date{color:#666;margin-bottom:1rem}</style>
  </head><body><h1>${escapeHtml(p.title)}</h1><div class="date">${escapeHtml(p.date||'')}</div><pre style="white-space:pre-wrap;font-family:inherit;">${escapeHtml(p.content)}</pre></body></html>`;
  win.document.write(html);
  win.document.close();
}
function escapeHtml(s=''){ return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

function downloadPoem(id) {
  const p = poems.find(x=>x.id===id); if (!p) return;
  const blob = new Blob([`${p.title}\n${p.date}\n\n${p.content}`], {type:'text/plain;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = sanitizeFilename(`${p.title || 'poem'}.txt`);
  document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
}
function sanitizeFilename(name){ return name.replace(/[\/\\?%*:|"<>]/g,'-'); }

function addOrUpdatePoem(e){ e.preventDefault(); const id = poemIdInput.value; const title = titleInput.value.trim() || 'Untitled'; const date = dateInput.value || ''; const content = contentInput.value.trim() || ''; if (!content){ alert('Please write your poem.'); return; }
  if (id) { const p = poems.find(x=>x.id===id); if (p) { p.title = title; p.date = date; p.content = content; p.updatedAt = Date.now(); } } else { const newP = { id: String(Date.now()) + Math.random().toString(36).slice(2,6), title, date, content, createdAt: Date.now(), updatedAt: Date.now() }; poems.push(newP); }
  save(); render(); poemForm.reset(); poemIdInput.value = ''; cancelEditBtn.style.display = 'none'; dateInput.value = todayInput(); }

function startEdit(id){ const p = poems.find(x=>x.id===id); if (!p) return; poemIdInput.value = p.id; titleInput.value = p.title; dateInput.value = p.date || todayInput(); contentInput.value = p.content; cancelEditBtn.style.display = 'inline-block'; window.scrollTo({top:0,behavior:'smooth'}); }
function cancelEdit(){ poemForm.reset(); poemIdInput.value=''; cancelEditBtn.style.display='none'; dateInput.value = todayInput(); }
function deletePoem(id){ if (!confirm('Delete this poem? This cannot be undone.')) return; poems = poems.filter(x=>x.id!==id); save(); render(); }

function exportAll(){ const data = JSON.stringify(poems, null, 2); const blob = new Blob([data], {type:'application/json'}); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'poems-backup.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(a.href); }

function importFromFile(file){ const reader = new FileReader(); reader.onload = () => { try { const arr = JSON.parse(reader.result); if (!Array.isArray(arr)) throw new Error('Invalid format'); const ids = new Set(poems.map(p=>p.id)); for (const item of arr) { if (!item.id) item.id = String(Date.now())+Math.random().toString(36).slice(2,6); if (!ids.has(item.id)) poems.push(item); } save(); render(); alert('Import complete.'); } catch (err) { alert('Failed to import: ' + err.message); } }; reader.readAsText(file); }

function downloadAll(){ exportAll(); }
function clearAll(){ if (!confirm('Delete ALL poems and backups stored in this browser?')) return; poems = []; save(); render(); }
function editSiteName(){ const newName = prompt('Site name / your display name', siteNameEl.textContent) || siteNameEl.textContent; siteNameEl.textContent = newName; }

poemForm.addEventListener('submit', addOrUpdatePoem);
cancelEditBtn.addEventListener('click', cancelEdit);
exportBtn.addEventListener('click', exportAll);
importBtn.addEventListener('click', () => importFile.click());
importFile.addEventListener('change', (e)=> { const f = e.target.files[0]; if (f) importFromFile(f); importFile.value=''; });
downloadAllBtn.addEventListener('click', downloadAll);
clearAllBtn.addEventListener('click', clearAll);
editNameBtn.addEventListener('click', editSiteName);

dateInput.value = todayInput();

function ensureSample(){ if (poems.length) return; poems.push({ id: 'sample1', title: 'A Quiet Dawn', date: todayInput(), content: 'This is a sample poem — replace it with your own.\n\nWrite a poem and click "Save poem" to add it to your list.', createdAt: Date.now(), updatedAt: Date.now() }); save(); }

load(); ensureSample(); render();
</script>
</body>
</html>
